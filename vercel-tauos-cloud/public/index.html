<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TauCloud - Privacy-First Cloud Storage</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #0f0f0f; color: #ffffff; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { text-align: center; margin-bottom: 40px; }
        .logo { font-size: 3rem; color: #3b82f6; margin-bottom: 10px; }
        .subtitle { color: #a1a1aa; font-size: 1.2rem; }
        
        .auth-container { display: flex; justify-content: center; gap: 40px; margin: 40px 0; }
        .auth-form { background: #1a1a1a; padding: 30px; border-radius: 12px; width: 350px; }
        .form-title { font-size: 1.5rem; margin-bottom: 20px; color: #3b82f6; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; color: #a1a1aa; }
        .form-group input { width: 100%; padding: 12px; border: 1px solid #333; border-radius: 6px; background: #0f0f0f; color: #fff; }
        .btn { width: 100%; padding: 12px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 1rem; }
        .btn:hover { background: #2563eb; }
        .toggle-form { text-align: center; margin-top: 20px; }
        .toggle-form a { color: #3b82f6; text-decoration: none; }
        
        .cloud-interface { display: none; background: #1a1a1a; border-radius: 12px; padding: 20px; }
        .cloud-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .upload-btn { background: #3b82f6; color: white; padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; }
        .storage-info { background: #2a2a2a; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .file-list { border-top: 1px solid #333; }
        .file-item { padding: 15px; border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center; }
        .file-info { flex: 1; }
        .file-name { font-weight: bold; margin-bottom: 5px; }
        .file-details { color: #a1a1aa; font-size: 0.9rem; }
        .file-actions { display: flex; gap: 10px; }
        .action-btn { background: #333; color: white; padding: 5px 10px; border: none; border-radius: 4px; cursor: pointer; font-size: 0.8rem; }
        .action-btn:hover { background: #444; }
        .error { color: #ef4444; margin-top: 10px; }
        .success { color: #10b981; margin-top: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">☁️</div>
            <h1>TauCloud</h1>
            <p class="subtitle">Privacy-First Cloud Storage</p>
        </div>

        <!-- Authentication Forms -->
        <div class="auth-container" id="authContainer">
            <div class="auth-form">
                <h2 class="form-title">Login</h2>
                <form id="loginForm">
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="loginEmail" required>
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="loginPassword" required>
                    </div>
                    <button type="submit" class="btn">Login</button>
                    <div id="loginError" class="error"></div>
                </form>
                <div class="toggle-form">
                    <a href="#" onclick="toggleForm()">Need an account? Register</a>
                </div>
            </div>

            <div class="auth-form" id="registerForm" style="display: none;">
                <h2 class="form-title">Register</h2>
                <form id="signupForm">
                    <div class="form-group">
                        <label>Name</label>
                        <input type="text" id="registerName" required>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="registerEmail" required>
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="registerPassword" required>
                    </div>
                    <button type="submit" class="btn">Register</button>
                    <div id="registerError" class="error"></div>
                </form>
                <div class="toggle-form">
                    <a href="#" onclick="toggleForm()">Already have an account? Login</a>
                </div>
            </div>
        </div>

        <!-- Cloud Interface -->
        <div class="cloud-interface" id="cloudInterface">
            <div class="cloud-header">
                <h2>Welcome, <span id="userName"></span></h2>
                <button class="upload-btn" onclick="showUpload()">Upload Files</button>
            </div>
            
            <div class="storage-info">
                <h3>Storage Usage</h3>
                <p>Used: <span id="storageUsed">0</span> / <span id="storageMax">5 GB</span></p>
                <div style="background: #333; height: 10px; border-radius: 5px; margin-top: 10px;">
                    <div id="storageBar" style="background: #3b82f6; height: 100%; border-radius: 5px; width: 0%;"></div>
                </div>
            </div>
            
            <div class="file-list" id="fileList">
                <!-- Files will be loaded here -->
            </div>
        </div>
    </div>

    <script>
        let currentUser = null;

        function toggleForm() {
            const loginForm = document.querySelector('.auth-form');
            const registerForm = document.getElementById('registerForm');
            
            if (registerForm.style.display === 'none') {
                loginForm.style.display = 'none';
                registerForm.style.display = 'block';
            } else {
                loginForm.style.display = 'block';
                registerForm.style.display = 'none';
            }
        }

        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            try {
                const response = await fetch('/api/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                const data = await response.json();
                if (data.success) {
                    currentUser = data.user;
                    localStorage.setItem('tauos-token', data.token);
                    showCloudInterface();
                } else {
                    document.getElementById('loginError').textContent = data.error;
                }
            } catch (error) {
                document.getElementById('loginError').textContent = 'Login failed: ' + error.message;
            }
        });

        document.getElementById('signupForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;

            try {
                const response = await fetch('/api/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, email, password })
                });

                const data = await response.json();
                if (data.success) {
                    currentUser = data.user;
                    localStorage.setItem('tauos-token', data.token);
                    showCloudInterface();
                } else {
                    document.getElementById('registerError').textContent = data.error;
                }
            } catch (error) {
                document.getElementById('registerError').textContent = 'Registration failed: ' + error.message;
            }
        });

        function showCloudInterface() {
            document.getElementById('authContainer').style.display = 'none';
            document.getElementById('cloudInterface').style.display = 'block';
            document.getElementById('userName').textContent = currentUser.name;
            updateStorageInfo();
            loadFiles();
        }

        function updateStorageInfo() {
            const used = (currentUser.storage / (1024 * 1024 * 1024)).toFixed(2);
            const max = (currentUser.maxStorage / (1024 * 1024 * 1024)).toFixed(0);
            const percentage = (currentUser.storage / currentUser.maxStorage) * 100;
            
            document.getElementById('storageUsed').textContent = used + ' GB';
            document.getElementById('storageMax').textContent = max + ' GB';
            document.getElementById('storageBar').style.width = percentage + '%';
        }

        async function loadFiles() {
            try {
                const response = await fetch(`/api/files/${currentUser.id}`);
                const files = await response.json();
                displayFiles(files);
            } catch (error) {
                console.error('Failed to load files:', error);
            }
        }

        function displayFiles(files) {
            const fileList = document.getElementById('fileList');
            fileList.innerHTML = '';

            if (files.length === 0) {
                fileList.innerHTML = '<div class="file-item"><p>No files yet. Upload your first file!</p></div>';
                return;
            }

            files.forEach(file => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `
                    <div class="file-info">
                        <div class="file-name">${file.name}</div>
                        <div class="file-details">${file.type} • ${(file.size / (1024 * 1024)).toFixed(2)} MB • ${new Date(file.date).toLocaleDateString()}</div>
                    </div>
                    <div class="file-actions">
                        <button class="action-btn" onclick="downloadFile(${file.id})">Download</button>
                        <button class="action-btn" onclick="deleteFile(${file.id})">Delete</button>
                    </div>
                `;
                fileList.appendChild(fileItem);
            });
        }

        function showUpload() {
            const input = document.createElement('input');
            input.type = 'file';
            input.multiple = true;
            input.onchange = handleFileUpload;
            input.click();
        }

        async function handleFileUpload(event) {
            const files = event.target.files;
            
            for (let file of files) {
                try {
                    const response = await fetch('/api/files', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            userId: currentUser.id,
                            name: file.name,
                            size: file.size,
                            type: file.type
                        })
                    });

                    const data = await response.json();
                    if (data.success) {
                        currentUser.storage += file.size;
                        updateStorageInfo();
                        loadFiles();
                    }
                } catch (error) {
                    console.error('Failed to upload file:', error);
                }
            }
        }

        function downloadFile(fileId) {
            alert('Download functionality would be implemented here');
        }

        function deleteFile(fileId) {
            if (confirm('Are you sure you want to delete this file?')) {
                // Implement delete functionality
                alert('Delete functionality would be implemented here');
            }
        }
    </script>
</body>
</html> 